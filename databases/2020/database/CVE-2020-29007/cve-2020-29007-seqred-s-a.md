# cve-2020-29007

Remote code execution in Mediawiki Score

| Infos    | Value                                                              |
| -------- | -------------------------------------------------------------------|
| Username | [https://github.com/seqred-s-a](https://github.com/seqred-s-a) |
| Url      | [https://github.com/seqred-s-a/cve-2020-29007](https://github.com/seqred-s-a/cve-2020-29007)                                               |
| Stars    | 0                                                          |
| License  | No License                                                        |

<details>

<summary>Topic / Tags</summary>

* cve* cve-2020-29007* exploit* lilypond* mediawiki* mediawiki-extension* security

</details>

## Readme

**CVEID**: CVE-2020-29007

**Name of the affected product(s) and version(s)**: Mediawiki Score (all versions up to 0.3.0)

**Problem type**: CWE-96: Improper Neutralization of Directives in Statically Saved Code (‘Static Code Injection’)

---

**Summary**

Score is a Mediawiki extension which generates musical notation based on user-provided Lilypond or ABC markup.
During our tests, we have determined it is vulnerable to remote code execution through Scheme code embedded in
Lilypond markup.

All version of Score (up to and including 0.3.0) allow the execution of arbitrary user-controlled code within
the context of a webserver process.
 
**Description**
 
Score extension generates musical notation by passing user-controlled Lilypond or ABC markup to a GNU Lilypond binary.
Because the binary is executed without the -dsafe option, it will execute arbitrary Guile Scheme code embedded within
Lilypond markup, including the code which interacts with operating system shell.

To exploit this vulnerability, the attacker must be able to edit any article on the vulnerable wiki.
In most configurations, it should be possible for the unauthenticated attacker.

**Reproduction**

1. Start editing any article on a wiki.

2. Replace the articles contents with the following code:
```
{{Image frame|content=\new Staff <<{g^#
(number->string(system "/usr/bin/false"))
}>>}}
```

3. Click ‘show preview’

4. If the output contains an image which looks like this, the wiki is vulnerable:
![256](binfalse.png)
 
**Mitigation**

Disable Score extension.



## Get the content

```
git clone https://github.com/seqred-s-a/cve-2020-29007
cd cve-2020-29007
```

{% embed url="https://github.com/seqred-s-a/cve-2020-29007" %}

<figure><img src="https://avatars.githubusercontent.com/u/49437606?v=4" alt=""><figcaption><p>seqred-s-a</p></figcaption></figure>
