# CVE-2022-24112

CVE-2022-24112：Apache APISIX apisix/batch-requests RCE

| Infos    | Value                                                              |
| -------- | -------------------------------------------------------------------|
| Username | [https://github.com/Mr-xn](https://github.com/Mr-xn) |
| Url      | [https://github.com/Mr-xn/CVE-2022-24112](https://github.com/Mr-xn/CVE-2022-24112)                                               |
| Stars    | 45                                                          |
| License  | Apache License 2.0                                                        |

<details>

<summary>Topic / Tags</summary>



</details>

## Readme

# CVE-2022-24112 
CVE-2022-24112：Apache APISIX apisix/batch-requests RCE

nuclei template ：[CVE-2022-24112.yaml](./CVE-2022-24112.yaml)

<img width="885" alt="shotpic_2022-02-22_23-36-38" src="https://user-images.githubusercontent.com/18260135/155166040-5538b9ed-26b0-4c82-8d96-848e7cbf1604.png">

这个漏洞本质利用和 [CVE-2021-45232](https://xz.aliyun.com/t/10738) 类似，都是绕过授权或未授权，来执行恶意的 route 里的 filter_func 或者 script 来执行命令

## 注意是事项

- `X-Real-IP` 的值可以是 `127.0.0.1`,`localhost` 或者 `2130706433` 
- `pipeline` 是必须项，以下为其 body 部分的值说明
-  `method` 固定为 `PUT`
-  `uri` 必须存在，这也是 exp 后需要访问来触发的 URL
-  `plugins`,`upstream/upstream_id`,`service_id` 这三个必须存在其中一个，详情可以参考官方文档

如果 service_id 不可用 可以替换成 `\"upstream\":{\"type\":\"roundrobin\",\"nodes\":{\"httpbin.org:80\":1}}`

参考:
- https://twitter.com/sirifu4k1/status/1496043663704858625
- https://apisix.apache.org/zh/docs/apisix/plugins/batch-requests



## Get the content

```
git clone https://github.com/Mr-xn/CVE-2022-24112
cd CVE-2022-24112
```

{% embed url="https://github.com/Mr-xn/CVE-2022-24112" %}

<figure><img src="https://avatars.githubusercontent.com/u/18260135?v=4" alt=""><figcaption><p>Mr-xn</p></figcaption></figure>
