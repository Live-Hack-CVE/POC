# CVE-2021-1675-LPE

Local Privilege Escalation Edition for CVE-2021-1675/CVE-2021-34527

| Infos    | Value                                                              |
| -------- | -------------------------------------------------------------------|
| Username | [https://github.com/hlldz](https://github.com/hlldz) |
| Url      | [https://github.com/hlldz/CVE-2021-1675-LPE](https://github.com/hlldz/CVE-2021-1675-LPE)                                               |
| Stars    | 335                                                          |
| License  | No License                                                        |

<details>

<summary>Topic / Tags</summary>

* cobaltstrike* cve-2021-1675* cve-2021-34527* exploit* lpe* printnightmare* reflectivedll* windows

</details>

## Readme

# Local Privilege Escalation Edition of CVE-2021-1675/CVE-2021-34527

Local Privilege Escalation implementation of the CVE-2021-1675/CVE-2021-34527 (a.k.a PrintNightmare). The exploit is edited from published by Zhiniang Peng (@edwardzpeng) & Xuefeng Li (@lxf02942370).

Open the project on MSVC and compile with x64 Release mode. Exploit automatically finds UNIDRV.DLL, no changes are required in the code. 

## Usage

When executing the exploit, you need to DLL path as the first argument to the exploit. That's it and go!

```
CVE-2021-1675-LPE.exe PAYLOAD_DLL_PATH
```

Exploit has been tested on the fully updated Windows Server 2019 Standard.

<p align="center"><img src="https://github.com/hlldz/CVE-2021-1675-LPE/blob/main/poc.png" alt="CVE-2021-1675 - Local Privilege Escalation" width="1024"></p>

## Cobalt Strike

For Reflective DLL version only, you have to change the DLL path at line 111 in main.cpp file and then compile the project. Load lpe_cve_2021_1675.cna and use lpe_cve_2021_1675 command for execution of Reflective DLL.

<p align="center"><img src="https://github.com/hlldz/CVE-2021-1675-LPE/blob/main/cobaltstrike.png" alt="CVE-2021-1675 - Local Privilege Escalation" width="1024"></p>


## Mitigation

Disable Spooler service

```powershell
Stop-Service Spooler
REG ADD  "HKLM\SYSTEM\CurrentControlSet\Services\Spooler"  /v "Start " /t REG_DWORD /d "4" /f
```

Or Uninstall Print-Services

```powershell
Uninstall-WindowsFeature Print-Services
```
## References
* https://github.com/afwu/PrintNightmare
* https://twitter.com/hackerfantastic/status/1410069557398679552
* https://twitter.com/0gtweet/status/1410150462842544130



## Get the content

```
git clone https://github.com/hlldz/CVE-2021-1675-LPE
cd CVE-2021-1675-LPE
```

{% embed url="https://github.com/hlldz/CVE-2021-1675-LPE" %}

<figure><img src="https://avatars.githubusercontent.com/u/16455559?v=4" alt=""><figcaption><p>hlldz</p></figcaption></figure>
