# CVE-2022-0847_dirty-pipe

Hacked up Dirty Pipe (CVE-2022-0847) PoC that hijacks a SUID binary to spawn a root shell. (and attempts to restore the damaged binary as well)

| Infos    | Value                                                              |
| -------- | -------------------------------------------------------------------|
| Username | [https://github.com/LudovicPatho](https://github.com/LudovicPatho) |
| Url      | [https://github.com/LudovicPatho/CVE-2022-0847_dirty-pipe](https://github.com/LudovicPatho/CVE-2022-0847_dirty-pipe)                                               |
| Stars    | 2                                                          |
| License  | No License                                                        |

<details>

<summary>Topic / Tags</summary>



</details>

## Readme

# CVE-2022-0847 / Dirty Pipe
Hacked up Dirty Pipe (CVE-2022-0847) PoC that hijacks a SUID binary to spawn a root shell. (and attempts to restore the damaged binary as well)

## Score CVSS : 7.8 HIGH
A flaw was found in the way the "flags" member of the new pipe buffer structure was lacking proper initialization in copy_page_to_iter_pipe and push_pipe functions in the Linux kernel and could thus contain stale values. An unprivileged local user could use this flaw to write to pages in the page cache backed by read only files and as such escalate their privileges on the system.

## POC
- **Author:** Max Kellermann max.kellermann@ionos.com
- **Contributor:** Bl4sty https://twitter.com/bl4sty

A new Linux vulnerability known as 'Dirty Pipe' allows local users to gain root privileges through publicly available exploits.

Today, security researcher Max Kellermann responsibly disclosed the 'Dirty Pipe' vulnerability and stated that it affects Linux Kernel 5.8 and later versions, even on Android devices.

The vulnerability is tracked as CVE-2022-0847 and allows a non-privileged user to inject and overwrite data in read-only files, including SUID processes that run as root.

Kellerman discovered the bug after tracking down a bug that was corrupting web server access logs for one of his customers. 

Then Bl4sty wrote another version. Instead of overwriting a file like /etc/passwd, it overwrites a user-specified SUID binary (like /bin/su), injecting shellcode that is then executed with privileged user (i.e. root) permissions. 

## Exploit
````
gcc dirtypipez.c -o exploit
````

````
./exploit /bin/su
````



## Get the content

```
git clone https://github.com/LudovicPatho/CVE-2022-0847_dirty-pipe
cd CVE-2022-0847_dirty-pipe
```

{% embed url="https://github.com/LudovicPatho/CVE-2022-0847_dirty-pipe" %}

<figure><img src="https://avatars.githubusercontent.com/u/26960886?v=4" alt=""><figcaption><p>LudovicPatho</p></figcaption></figure>
